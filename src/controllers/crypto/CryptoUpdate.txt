package controllers

import (
	"fmt"
	"gokripto/Database"
	model "gokripto/Model"
	"strconv"

	"github.com/gofiber/contrib/websocket"
)

func WebSocketUpdateCrypto(ws *websocket.Conn) {
	var cryptos []model.Crypto
	if err := Database.DB.Find(&cryptos).Error; err != nil {
		ws.Close()
		return
	}

	for i := range cryptos {
		var cryptoData model.CryptoData

		priceFloat, err := strconv.ParseFloat(cryptos[i].Price, 64)
		if err != nil {
			fmt.Printf("PriceUsd'yi çevirirken hata oluştu: %v\n", err)
			return
		}

		cryptos[i].Name = cryptoData.Name
		cryptos[i].Price = priceFloat

		if err := Database.DB.Save(&cryptos[i]).Error; err != nil {
			ws.Close()
			return
		}

		fmt.Println("başarılı")
	}

}
